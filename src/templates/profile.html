<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile page - Lookout</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;700&display=swap" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="../templates/css/profile.css" />
  </head>
  <body>
    <div class="main-container">
      <div class="desktop">
          <div class="vector"></div>
        <div class="frame" id="header">
        <!-- Logo -->
        <div class="logo">
          <div class="logo-icon"></div>
          <span class="logo-text">LOOKOUT</span>
        </div>

        <!-- Hamburger menu (mobile only) -->
        <div class="hamburger" onclick="toggleMobileMenu()">
          <span></span>
          <span></span>
          <span></span>
        </div>

        <!-- Navigation (Desktop) -->
        <nav class="navbar-links desktop-only">
          <a href="index.html#about" class="nav-link">ABOUT</a>
          <a href="index.html#why-lookout" class="nav-link">WHY LOOKOUT</a>
          <a href="index.html#how-it-works" class="nav-link">HOW IT WORKS</a>
          <a href="index.html#try-it-out" class="nav-link">TRY IT OUT</a>
        </nav>

        <!-- Action Buttons (Desktop) -->
        <div class="header-right desktop-only">
            <div class="user-name">??</div>

            <a href="profile.html" class="icon-circle" aria-label="Profile">
              <div class="profile-icon-gradient"></div>
            </a>


            <div class="icon logout-icon"></div>
        </div>
        <div class="user-name-mobile">??</div>
        <!-- Mobile Dropdown -->
        <div class="mobile-nav" id="mobileNav">
          <div style="display: flex; flex-direction: row; justify-content: space-between; width: 100%">
            <a href="profile.html" class="icon-circle" aria-label="Profile">
              <div class="profile-icon-gradient"></div>
            </a>
          <div class="icon logout-icon"></div>
          </div>
          <a href="index.html#about">ABOUT</a>
          <a href="index.html#why-lookout">WHY LOOKOUT</a>
          <a href="index.html#how-it-works">HOW IT WORKS</a>
          <a href="index.html#try-it-out">TRY IT OUT</a>
        </div>
      </div>
<!--        WRITE YOUR CODE HERE  -->

                  <div class="container">
              <div class="profile-header">
<!--                <h2>Alua Kusman</h2>-->
                <h5>example@mail.com</h5>
                <h5>Member since: April 2025</h5>
              </div>

              <div class="stats-box">
                <div class="stat-item">
                  <div class="stat-icon"></div>
                  <span>12 videos analyzed</span>
                </div>
<!--                <div class="stat-item">-->
<!--                  <div class="stat-icon"></div>-->
<!--                  <span>4 documents downloaded</span>-->
<!--                </div>-->
              </div>

<!--              <div class="result-table">-->
              <div class="download-history-table">
                <table>
                  <thead>
                    <tr>
                      <th>File Name</th>
                      <th>Result</th>
                      <th>Confidence</th>
                      <th>Date & Time</th>
                    </tr>
                  </thead>
                  <tbody id="download-history-body">
<!--                    <tr>-->
<!--                      <td>myvideo.mp4</td>-->
<!--                      <td><span class="badge fake">FAKE</span></td>-->
<!--                      <td>83%</td>-->
<!--                      <td>10 April 2025, 14:32</td>-->
<!--                    </tr>-->
<!--                    <tr>-->
<!--                      <td>fake_video.mov</td>-->
<!--                      <td><span class="badge real">REAL</span></td>-->
<!--                      <td>85%</td>-->
<!--                      <td>9 April 2025, 11:35</td>-->
<!--                    </tr>-->
<!--                    <tr>-->
<!--                      <td>real-video.mp4</td>-->
<!--                      <td><span class="badge fake">FAKE</span></td>-->
<!--                      <td>92%</td>-->
<!--                      <td>8 April 2025, 09:45</td>-->
<!--                    </tr>-->
                  </tbody>
                </table>
<!--                <div class="download-btn-wrapper">-->
<!--                  <button class="btn-download">DOWNLOAD</button>-->
<!--                </div>-->
              </div>

              <a href="upload.html">
                <button class="btn-analyze">ANALYZE NEW VIDEO</button>
              </a>

            </div>


<!--            FOOTER CODE START-->
            <footer class="footer">
              <div class="footer-background"></div>

              <div class="footer-content">
                <div class="footer-logo" >
                  <div class="footer-logo-icon"></div>
                  <span class="footer-logo-text">LOOKOUT</span>
                </div>

                <div class="footer-divider"></div>

                <div class="footer-column">
                  <h5><a href="index.html#about" style="text-decoration: none; color: white">ABOUT</a></h5>
                  <h5><a href="index.html#why-lookout" style="text-decoration: none; color: white">Why Lookout</a></h5>
                  <h5><a href="index.html#how-it-works" style="text-decoration: none; color: white">How it Works</a></h5>
<!--                  <h5><a href="#why-lookout" style="text-decoration: none; color: white">How To</a></h5>-->
                </div>

                <div class="footer-divider"></div>

                <div class="footer-column">
                  <h5><a href="index.html#faq" style="text-decoration: none; color: white">F.A.Q</a></h5>
                  <h5><a href="index.html#header" style="text-decoration: none; color: white">Sitemap</a></h5>
<!--                  <h5>Conditions</h5>-->
<!--                  <h5>Licenses</h5>-->
                </div>

                <div class="footer-divider"></div>

                <div class="footer-column">
                  <h5>Socialize with Lookout</h5>
                  <div class="social-icons">
                    <a href="https://www.facebook.com/lookoutapp" target="_blank" aria-label="Facebook">
                      <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-12/c7z2ZSvmCj.png" alt="Facebook" />
                    </a>
                    <a href="https://twitter.com/lookoutapp" target="_blank" aria-label="Twitter">
                      <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-12/i4Y310fnY6.png" alt="Twitter" />
                    </a>
                    <a href="https://www.linkedin.com/company/lookoutapp" target="_blank" aria-label="LinkedIn">
                      <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-12/bQOUO7mF4k.png" alt="LinkedIn" />
                    </a>
                    <a href="https://www.youtube.com/@lookoutapp" target="_blank" aria-label="YouTube">
                      <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-12/DpEvVZuXOE.png" alt="YouTube" />
                    </a>
                    <a href="https://www.instagram.com/lookoutapp" target="_blank" aria-label="Instagram">
                      <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-12/M2DwYnSJiQ.png" alt="Instagram" />
                    </a>
                    <a href="https://www.pinterest.com/lookoutapp" target="_blank" aria-label="Pinterest">
                      <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-17/ZZaQ5CYZ3H.png" alt="Pinterest" />
                    </a>
                  </div>
                  <div class="footer-button">PROTECT THE TRUTH</div>
                </div>
              </div>

              <hr class="footer-line" />
              <p class="copyright">2025Â© LOOKOUT - ALL RIGHTS RESERVED</p>
            </footer>
     </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>

    <script>
      function toggleMobileMenu() {
        const nav = document.getElementById("mobileNav");
        nav.classList.toggle("show");
      }

      // Optional: auto-close on link click
      document.querySelectorAll(".mobile-nav a").forEach(link =>
        link.addEventListener("click", () => {
          document.getElementById("mobileNav").classList.remove("show");
        })
      );
    </script>
<script>
  document.addEventListener("DOMContentLoaded", async () => {
    try {
      const token = localStorage.getItem("access_token");

      if (!token) {
        alert("Please log in to view your profile.");
        window.location.href = "login.html";
        return;
      }

      // Fetch user info
      const response = await fetch("http://127.0.0.1:8000/api/v1/auth/info", {
        method: "GET",
        headers: { Authorization: `Bearer ${token}` }
      });

      if (!response.ok) {
        localStorage.removeItem("access_token");
        alert("Please log in to view your profile.");
        window.location.href = "login.html";
        return;
      }

      const data = await response.json();
      const userId = data.id;

      // Update profile info
      document.querySelector(".user-name").textContent = data.username;
      document.querySelector(".user-name-mobile").textContent = data.username;
      document.querySelector(".profile-header h5:nth-child(1)").textContent = data.email;
      const date = new Date(data.created_at);
      document.querySelector(".profile-header h5:nth-child(2)").textContent =
        `Member since: ${date.toLocaleDateString("en-US", { year: 'numeric', month: 'long', day: 'numeric' })}`;

      // Default stat box for videos
      const videoStatBox = document.querySelector(".stats-box .stat-item span");
      videoStatBox.textContent = "0 videos analyzed";

      // Add doc stat box
      const docStatBox = document.createElement("div");
      docStatBox.className = "stat-item";
      docStatBox.innerHTML = `<div class="stat-icon"></div><span id="doc-count">0 documents downloaded</span>`;
      document.querySelector(".stats-box").appendChild(docStatBox);

      // Fetch document download count
      try {
        const docRes = await fetch("http://127.0.0.1:8000/api/v1/download/count", {
          headers: { Authorization: `Bearer ${token}` }
        });
        if (docRes.ok) {
          const docData = await docRes.json();
          document.getElementById("doc-count").textContent =
            `${docData.count} document${docData.count === 1 ? '' : 's'} downloaded`;
        }
      } catch (err) {
        document.getElementById("doc-count").textContent = "0 documents downloaded";
      }

      // Fetch download history
      try {
        const historyRes = await fetch("http://127.0.0.1:8000/api/v1/download/history", {
          headers: { Authorization: `Bearer ${token}` }
        });

        const historyBody = document.getElementById("download-history-body");
        historyBody.innerHTML = "";

        if (historyRes.ok) {
          const historyData = await historyRes.json();
          if (historyData.length === 0) {
            historyBody.innerHTML = `<tr><td colspan="4" style="text-align: center;">No reports downloaded yet.</td></tr>`;
          } else {
            historyData.forEach(d => {
              const row = `
                <tr>
                  <td>${d.video_id}</td>
                  <td><span class="badge ${d.result.toLowerCase()}">${d.result}</span></td>
                  <td>${(d.confidence * 100).toFixed(2)}%</td>
                  <td>${new Date(d.timestamp).toLocaleString()}</td>
                </tr>`;
              historyBody.insertAdjacentHTML("beforeend", row);
            });
          }
        }
      } catch (err) {
        console.warn("No download history found");
      }

      // Fetch user videos
      const videoRes = await fetch(`http://127.0.0.1:8000/api/v1/video/users/${userId}`, {
        method: "GET",
        headers: { Authorization: `Bearer ${token}` }
      });

      const tbody = document.querySelector("tbody");

      if (videoRes.status === 404) {
        tbody.innerHTML = `
          <tr>
            <td colspan="4" style="text-align:center; font-style: italic; color: gray;">No videos uploaded yet.</td>
          </tr>`;
        return;
      }

      const videoData = await videoRes.json();

      if (!videoRes.ok) {
        throw new Error(videoData.detail || "Failed to fetch videos");
      }

      const videos = videoData.data;
      videoStatBox.textContent = `${videos.length} video${videos.length === 1 ? '' : 's'} analyzed`;
      tbody.innerHTML = "";

      videos.forEach(video => {
        const row = `
          <tr>
            <td>${video.file_name || "Untitled"}</td>
            <td><span class="badge">â</span></td>
            <td>â</td>
            <td>${new Date(video.created_at).toLocaleString()}</td>
          </tr>`;
        tbody.insertAdjacentHTML("beforeend", row);
      });

    } catch (err) {
      console.warn("Handled gracefully:", err);
    }
  });

  document.querySelectorAll(".logout-icon").forEach(icon => {
    icon.addEventListener("click", () => {
      localStorage.removeItem("access_token");
      window.location.href = "login.html";
    });
  });
</script>


  </body>
</html>